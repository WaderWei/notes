# 搭建PXC集群

![1571551451067](.\数据库集群2.assets\1571551451067.png)

![1571551736241](.\数据库集群2.assets\1571551736241.png)

2377端口：其它工作节点能够加入swarm集群中

7946与4789：用于虚拟网路之间的通信

![1571551858830](.\数据库集群2.assets\1571551858830.png)

![1571551983756](.\数据库集群2.assets\1571551983756.png)

![1571552066956](.\数据库集群2.assets\1571552066956.png)![1571552230010](.\数据库集群2.assets\1571552230010.png)

-d：docker容器后台运行

-p：端口映射

-e：

	1. mysql root账户的密码
 	2. 集群的名称
 	3. 集群节点之间数据同步的验证密码

-v：数据挂载映射

--name：容器的名字

--net：容器要使用什么样的虚拟网络



![1571552584119](.\数据库集群2.assets\1571552584119.png)

将pn2容器加入到pn1集群中

**创建好从节点后，就没有主从之间的区分了，利用navicat连接，各个节点之间的虚拟机ip不同**

pxc集群上的各个数据库之间的数据是实时同步的。

![1571553029654](.\数据库集群2.assets\1571553029654.png)

![1571553095865](.\数据库集群2.assets\1571553095865.png)



# PXC集群的注意事项

![1571553385067](.\数据库集群2.assets\1571553385067.png)

![1571553425936](.\数据库集群2.assets\1571553425936.png)

先用navicat连接主节点，确定连接成功，在创建从节点

![1571553614747](.\数据库集群2.assets\1571553614747.png)![1571553638215](.\数据库集群2.assets\1571553638215.png)

![1571553882777](.\数据库集群2.assets\1571553882777.png)

到主节点把这个配置文件的参数改为1，然后启动此主节点docker start pn1。然后再分别启动其它节点。

![1571554067990](.\数据库集群2.assets\1571554067990.png)

注意查看主节点的safe_boot_strap是不是等于1，不是的话，启动主节点会闪退，要把它改为1，再启动其它节点。

![1571554186013](.\数据库集群2.assets\1571554186013.png)

![1571554224763](.\数据库集群2.assets\1571554224763.png)

# 搭建PXC集群分片

![1571554409698](.\数据库集群2.assets\1571554409698.png)

因为PXC集群中的各个节点是数据强一致性，因此不宜搞特别多的pxc节点，会影响性能，保证在15个一下。

![1571554581442](.\数据库集群2.assets\1571554581442.png)

![1571554696514](.\数据库集群2.assets\1571554696514.png)

![1571554705754](.\数据库集群2.assets\1571554705754.png)

注意创建集群前，统计好表格，这里用的是同一个swarm虚拟网络，不同的pxc集群



